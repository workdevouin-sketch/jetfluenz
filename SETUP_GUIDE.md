# JetFluenz - Setup & Migration Guide

## ğŸš€ Quick Start

### Step 1: Download Service Account Key
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project
3. **Project Settings** â†’ **Service Accounts** â†’ **Generate New Private Key**
4. Save as `serviceAccountKey.json` in project root

### Step 2: Install Dependencies
```bash
npm install firebase-admin
```

### Step 3: Create Admin Account
```bash
node src/scripts/createAdminAccount.js
```
Follow the prompts to create your admin account.

### Step 4: Migrate Existing Users (if applicable)
```bash
node src/scripts/migrateUsersToAuth.js
```
This creates Firebase Auth accounts for all Firestore users.

### Step 5: Start the App
```bash
npm run dev
```
Visit `http://localhost:3000/login`

---

## ğŸ“š Documentation

- **[SCRIPTS_REFERENCE.md](./SCRIPTS_REFERENCE.md)** - Complete guide to all scripts
- **[FIX_UID_MISMATCH.md](./FIX_UID_MISMATCH.md)** - Fix UID mismatch issues
- **[MIGRATION_GUIDE.md](./MIGRATION_GUIDE.md)** - Detailed migration guide
- **[TROUBLESHOOTING.md](./TROUBLESHOOTING.md)** - Login troubleshooting
- **[QUICK_START_MIGRATION.md](./QUICK_START_MIGRATION.md)** - Quick migration steps

---

## ğŸ› ï¸ Available Scripts

### Create Admin Account
```bash
node src/scripts/createAdminAccount.js
```
Creates an admin account with matching Firebase Auth and Firestore UIDs.

### Migrate Users to Auth
```bash
node src/scripts/migrateUsersToAuth.js
```
Migrates all Firestore users to Firebase Auth with matching UIDs.

---

## ğŸ”§ Admin Tools (Browser-Based)

After logging in as admin, access these tools:

- **`/admin/migrate-users`** - Browser-based migration tool (limited functionality)
- **`/admin/fix-mismatch`** - Diagnose UID mismatch issues
- **`/diagnostic`** - Check authentication status and user data

---

## âš ï¸ Important Notes

### UID Matching
- âœ… **Use Node.js scripts** for production migrations
- âŒ **Avoid browser tool** for migrations (creates mismatched UIDs)
- âœ… **Always verify** UIDs match between Auth and Firestore

### Security
- ğŸ”’ Never commit `serviceAccountKey.json` to git
- ğŸ”’ Add to `.gitignore`
- ğŸ”’ Users should change password after migration
- ğŸ”’ Implement forced password change on first login

### Initial Passwords
After migration, users log in with:
- **Email:** Their email from Firestore
- **Password:** Their Firestore document ID

---

## ğŸ› Common Issues

### Login shows "unable to load user data"
**Cause:** UID mismatch between Auth and Firestore  
**Fix:** See [FIX_UID_MISMATCH.md](./FIX_UID_MISMATCH.md)

### "serviceAccountKey.json not found"
**Cause:** Service account key not downloaded  
**Fix:** Follow Step 1 above

### "Email already exists"
**Cause:** User already exists in Firebase Auth  
**Fix:** Delete existing Auth user or use update functionality

---

## ğŸ“ Project Structure

```
jetfluenz/
â”œâ”€â”€ serviceAccountKey.json          # Firebase Admin credentials (don't commit!)
â”œâ”€â”€ migration-results.json          # Generated by migration script
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ createAdminAccount.js   # Create admin accounts
â”‚   â”‚   â””â”€â”€ migrateUsersToAuth.js   # Migrate users to Auth
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ login/page.js           # Login page
â”‚   â”‚   â”œâ”€â”€ diagnostic/page.js      # Diagnostic tool
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ migrate-users/      # Browser migration tool
â”‚   â”‚       â””â”€â”€ fix-mismatch/       # UID mismatch diagnostic
â”‚   â””â”€â”€ contexts/
â”‚       â””â”€â”€ AuthContext.js          # Authentication context
â””â”€â”€ Documentation files (.md)
```

---

## ğŸ¯ Recommended Workflow

### For Fresh Installation:
1. Create admin account
2. Log in and start using the app

### For Existing Firestore Users:
1. Create admin account
2. Run migration script
3. Verify UIDs match in Firebase Console
4. Test login with sample user
5. Notify users of temporary passwords
6. Implement password change requirement

### For UID Mismatch Issues:
1. Delete mismatched Auth users
2. Run migration script again
3. Verify UIDs match
4. Test login

---

## ğŸ“ Support

Check the documentation files for detailed guides:
- Script usage â†’ `SCRIPTS_REFERENCE.md`
- UID issues â†’ `FIX_UID_MISMATCH.md`
- Login issues â†’ `TROUBLESHOOTING.md`
- Migration â†’ `MIGRATION_GUIDE.md`

---

## âœ… Verification Checklist

- [ ] Downloaded `serviceAccountKey.json`
- [ ] Installed `firebase-admin`
- [ ] Created admin account
- [ ] Migrated users (if applicable)
- [ ] Verified UIDs match in Firebase Console
- [ ] Tested login with admin account
- [ ] Tested login with regular user
- [ ] Checked diagnostic page shows correct data
- [ ] Planned password change implementation

---

**Last Updated:** February 2026  
**Version:** 1.0
